<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced PBPK Modeling & Pharmacology Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .quiz-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .quiz-header h1 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2.2em;
        }

        .quiz-header p {
            color: #666;
            font-size: 1.1em;
        }

        .setup-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .setup-section {
            margin-bottom: 30px;
        }

        .setup-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .topic-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .topic-card:hover {
            border-color: #667eea;
            background: #edf2f7;
            transform: translateY(-2px);
        }

        .topic-card.selected {
            border-color: #667eea;
            background: #e6fffa;
        }

        .topic-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .topic-description {
            font-size: 0.9em;
            color: #4a5568;
            line-height: 1.4;
        }

        .topic-count {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .question-count-section {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .question-count-section label {
            font-weight: 600;
            color: #2d3748;
        }

        .question-count-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .count-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            font-size: 1em;
        }

        .count-btn {
            background: #667eea;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .count-btn:hover {
            background: #5a67d8;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            transition: width 0.3s ease;
            border-radius: 5px;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #4a5568;
        }

        .question-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        .topic-badge {
            background: #e6fffa;
            color: #234e52;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.9em;
            border: 1px solid #b2f5ea;
        }

        .question-text {
            font-size: 1.2em;
            color: #2d3748;
            margin-bottom: 25px;
            font-weight: 500;
            line-height: 1.7;
        }

        .options-container {
            margin-bottom: 25px;
        }

        .option {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: #667eea;
            background: #edf2f7;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: #e6fffa;
        }

        .option.correct {
            border-color: #48bb78;
            background: #f0fff4;
            color: #22543d;
        }

        .option.incorrect {
            border-color: #f56565;
            background: #fed7d7;
            color: #742a2a;
        }

        .option-letter {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .option.correct .option-letter {
            background: #48bb78;
        }

        .option.incorrect .option-letter {
            background: #f56565;
        }

        .explanation {
            background: #edf2f7;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .explanation h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .explanation p {
            color: #4a5568;
            line-height: 1.6;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .results-container {
            text-align: center;
            padding: 40px;
        }

        .score-display {
            font-size: 3em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .score-message {
            font-size: 1.3em;
            color: #4a5568;
            margin-bottom: 30px;
        }

        .performance-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .performance-item {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }

        .performance-label {
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .performance-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #2d3748;
        }

        .topic-performance {
            margin-top: 30px;
            text-align: left;
        }

        .topic-performance h4 {
            color: #2d3748;
            margin-bottom: 15px;
        }

        .topic-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f7fafc;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .question-container, .setup-container {
                padding: 20px;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .topics-grid {
                grid-template-columns: 1fr;
            }
            
            .question-count-section {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="quiz-header">
            <h1>Advanced PBPK Modeling & Pharmacology Quiz</h1>
            <p>Comprehensive assessment covering physiologically-based pharmacokinetic modeling, transporters, enzymes, pregnancy models, and gut microbiome</p>
        </div>

        <!-- Quiz Setup Screen -->
        <div id="setupContainer" class="setup-container">
            <div class="setup-section">
                <h3>Select Topics</h3>
                <div class="topics-grid" id="topicsGrid">
                    <!-- Topics will be populated by JavaScript -->
                </div>
                <button class="btn btn-secondary" onclick="selectAllTopics()">Select All</button>
                <button class="btn btn-secondary" onclick="clearAllTopics()">Clear All</button>
            </div>

            <div class="setup-section">
                <h3>Configure Quiz</h3>
                <div class="question-count-section">
                    <label>Number of Questions:</label>
                    <div class="question-count-controls">
                        <button class="count-btn" onclick="adjustQuestionCount(-5)">-5</button>
                        <button class="count-btn" onclick="adjustQuestionCount(-1)">-</button>
                        <input type="number" id="questionCount" class="count-input" value="20" min="5" max="100">
                        <button class="count-btn" onclick="adjustQuestionCount(1)">+</button>
                        <button class="count-btn" onclick="adjustQuestionCount(5)">+5</button>
                    </div>
                    <span id="availableQuestions" style="margin-left: 20px; color: #666;"></span>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-primary" onclick="startQuiz()">Start Quiz</button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div id="progressContainer" class="progress-container hidden">
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div id="progressText" class="progress-text">Question 1 of 20</div>
        </div>

        <!-- Question Container -->
        <div id="questionContainer" class="question-container hidden">
            <div class="question-header">
                <div id="questionNumber" class="question-number">Question 1</div>
                <div id="topicBadge" class="topic-badge">Topic</div>
            </div>
            
            <div id="questionText" class="question-text"></div>
            
            <div id="optionsContainer" class="options-container"></div>
            
            <div id="explanation" class="explanation hidden">
                <h4>Explanation</h4>
                <p id="explanationText"></p>
            </div>
            
            <div class="nav-buttons">
                <button id="prevBtn" class="btn btn-secondary" onclick="previousQuestion()" disabled>Previous</button>
                <button id="nextBtn" class="btn btn-primary" onclick="nextQuestion()" disabled>Next Question</button>
                <button id="submitBtn" class="btn btn-primary hidden" onclick="submitQuiz()">Submit Quiz</button>
            </div>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="question-container results-container hidden">
            <h2>Quiz Results</h2>
            <div id="scoreDisplay" class="score-display"></div>
            <div id="scoreMessage" class="score-message"></div>
            
            <div class="performance-breakdown">
                <div class="performance-item">
                    <div class="performance-label">Correct Answers</div>
                    <div id="correctCount" class="performance-value">0</div>
                </div>
                <div class="performance-item">
                    <div class="performance-label">Total Questions</div>
                    <div id="totalCount" class="performance-value">20</div>
                </div>
                <div class="performance-item">
                    <div class="performance-label">Percentage</div>
                    <div id="percentage" class="performance-value">0%</div>
                </div>
                <div class="performance-item">
                    <div class="performance-label">Average Time</div>
                    <div id="averageTime" class="performance-value">--</div>
                </div>
            </div>

            <div id="topicPerformance" class="topic-performance">
                <h4>Performance by Topic</h4>
                <div id="topicScores"></div>
            </div>
            
            <div class="nav-buttons" style="margin-top: 30px;">
                <button class="btn btn-primary" onclick="restartQuiz()">New Quiz</button>
                <button class="btn btn-secondary" onclick="reviewAnswers()">Review Answers</button>
            </div>
        </div>
    </div>

    <script>
        // Question database organized by topics
        const questionDatabase = {
            'basic_pbpk': {
                title: 'Basic PBPK Concepts',
                description: 'Fundamental principles of physiologically-based pharmacokinetic modeling',
                questions: [
                    {
                        question: "In PBPK modeling, what does the term 'perfusion-limited' distribution primarily describe?",
                        options: [
                            "Drug distribution is limited by blood flow to the tissue",
                            "Drug distribution is limited by membrane permeability",
                            "Drug distribution is limited by protein binding",
                            "Drug distribution is limited by active transport"
                        ],
                        correct: 0,
                        explanation: "Perfusion-limited distribution occurs when drug movement across tissue membranes is rapid compared to blood flow. In this case, the rate-limiting step for drug distribution is the perfusion (blood flow) to the tissue, not membrane permeability."
                    },
                    {
                        question: "Which physiological parameter is most critical when scaling clearance from preclinical species to humans using allometric scaling?",
                        options: [
                            "Brain weight",
                            "Body weight",
                            "Liver weight", 
                            "Kidney weight"
                        ],
                        correct: 1,
                        explanation: "Body weight is the fundamental parameter for allometric scaling in PBPK models. The relationship CL = a × BWᵇ (where b is typically 0.75 for metabolic clearance) allows extrapolation across species based on body weight differences."
                    },
                    {
                        question: "In the 'bottom-up' PBPK modeling approach, tissue partition coefficients (Kp) are typically predicted using:",
                        options: [
                            "In vivo pharmacokinetic data",
                            "Physicochemical properties and tissue composition",
                            "Population pharmacokinetic analysis",
                            "Clinical bioequivalence studies"
                        ],
                        correct: 1,
                        explanation: "The bottom-up approach uses physicochemical properties (logP, pKa, fu) combined with tissue composition data (water content, lipid content, protein binding) to predict Kp values mechanistically, rather than fitting to observed data."
                    },
                    {
                        question: "What is the primary advantage of incorporating active transport processes in PBPK models?",
                        options: [
                            "Reduces model complexity",
                            "Eliminates the need for in vitro data",
                            "Better prediction of drug-drug interactions and genetic polymorphisms",
                            "Simplifies regulatory submissions"
                        ],
                        correct: 2,
                        explanation: "Including active transport (e.g., P-gp, OATP, OCT) allows PBPK models to predict DDIs when transporters are inhibited/induced and to account for genetic polymorphisms affecting transporter expression, improving model predictivity."
                    },
                    {
                        question: "In hepatic clearance prediction, the 'well-stirred model' assumes:",
                        options: [
                            "Drug concentration is uniform throughout the liver",
                            "Only passive diffusion occurs",
                            "Protein binding is negligible",
                            "Metabolism follows zero-order kinetics"
                        ],
                        correct: 0,
                        explanation: "The well-stirred (venous equilibrium) model assumes complete mixing, so drug concentration is uniform throughout the hepatocyte and equals the venous concentration leaving the liver."
                    }
                ]
            },
            'transporters_enzymes': {
                title: 'Transporters & Metabolizing Enzymes',
                description: 'Drug transporters, cytochrome P450 enzymes, and their measurement techniques',
                questions: [
                    {
                        question: "Which in vitro system is most appropriate for measuring P-glycoprotein (P-gp) efflux ratios?",
                        options: [
                            "Hepatocytes",
                            "Caco-2 cells",
                            "Microsomes",
                            "S9 fractions"
                        ],
                        correct: 1,
                        explanation: "Caco-2 cells are the gold standard for measuring P-gp efflux ratios due to their high P-gp expression and ability to measure bidirectional transport (A→B vs B→A) to calculate efflux ratios."
                    },
                    {
                        question: "The Recovery Index (% Recovery) in microsomal stability assays should ideally be:",
                        options: [
                            "≥80% for reliable CLint calculations",
                            "≤50% to ensure adequate turnover",
                            "Exactly 100% for all compounds",
                            "Between 60-70% for optimal conditions"
                        ],
                        correct: 0,
                        explanation: "Recovery Index ≥80% indicates minimal non-specific binding and degradation, ensuring that the measured disappearance reflects true metabolic clearance rather than artifacts."
                    },
                    {
                        question: "OATP1B1 and OATP1B3 transporters are primarily expressed in:",
                        options: [
                            "Kidney proximal tubules",
                            "Blood-brain barrier",
                            "Hepatic sinusoidal membrane",
                            "Intestinal enterocytes"
                        ],
                        correct: 2,
                        explanation: "OATP1B1 and OATP1B3 are specifically localized at the hepatic sinusoidal (basolateral) membrane, facilitating uptake of drugs and endogenous compounds from blood into hepatocytes."
                    },
                    {
                        question: "In CYP3A4 induction studies, the positive control typically used is:",
                        options: [
                            "Ketoconazole",
                            "Rifampicin",
                            "Quinidine",
                            "Fluvoxamine"
                        ],
                        correct: 1,
                        explanation: "Rifampicin is the prototypical CYP3A4 inducer used as positive control, activating the pregnane X receptor (PXR) pathway to increase CYP3A4 mRNA and protein expression."
                    },
                    {
                        question: "The 'cut-off' criteria for clinically relevant transporter inhibition in vitro is typically:",
                        options: [
                            "IC50 < 10 μM",
                            "IC50 < 1 μM", 
                            "R-value ≥ 1.1",
                            "Efflux ratio > 2"
                        ],
                        correct: 2,
                        explanation: "R-value (1 + [I]/IC50) ≥ 1.1 is the regulatory criterion, where [I] is the unbound inhibitor concentration and IC50 is the inhibition constant. This indicates ≥10% inhibition potential in vivo."
                    },
                    {
                        question: "UGT enzymes primarily catalyze:",
                        options: [
                            "Oxidative metabolism",
                            "Hydrolysis reactions",
                            "Glucuronidation conjugation",
                            "Acetylation reactions"
                        ],
                        correct: 2,
                        explanation: "UDP-glucuronosyltransferases (UGTs) catalyze glucuronidation, a Phase II conjugation reaction that attaches glucuronic acid to compounds, typically increasing their hydrophilicity and facilitating excretion."
                    }
                ]
            },
            'pregnancy_pbpk': {
                title: 'Pregnancy PBPK Models',
                description: 'Physiological changes during pregnancy and maternal-fetal drug transfer',
                questions: [
                    {
                        question: "During the third trimester of pregnancy, cardiac output typically increases by:",
                        options: [
                            "10-20%",
                            "30-50%",
                            "60-80%",
                            "90-110%"
                        ],
                        correct: 1,
                        explanation: "Cardiac output increases by 30-50% during pregnancy, peaking in the second trimester and remaining elevated through the third trimester. This significantly affects drug distribution and clearance."
                    },
                    {
                        question: "Which CYP enzyme shows the most significant induction during pregnancy?",
                        options: [
                            "CYP1A2",
                            "CYP2D6",
                            "CYP3A4",
                            "CYP2C19"
                        ],
                        correct: 2,
                        explanation: "CYP3A4 activity increases substantially (up to 2-fold) during pregnancy due to hormonal induction, significantly affecting the metabolism of CYP3A4 substrates like nifedipine and midazolam."
                    },
                    {
                        question: "The placental transfer of drugs is primarily determined by:",
                        options: [
                            "Molecular weight alone",
                            "Lipophilicity, protein binding, and molecular weight",
                            "Maternal blood flow only",
                            "Fetal organ development stage"
                        ],
                        correct: 1,
                        explanation: "Placental drug transfer depends on multiple factors: lipophilicity (for passive diffusion), protein binding (affects free fraction), molecular weight (>500 Da limits transfer), and presence of active transporters."
                    },
                    {
                        question: "In pregnancy PBPK models, the most challenging parameter to accurately predict is:",
                        options: [
                            "Maternal plasma volume changes",
                            "Renal clearance changes",
                            "Placental drug transfer kinetics",
                            "Cardiac output changes"
                        ],
                        correct: 2,
                        explanation: "Placental transfer is most challenging due to complex, compound-specific mechanisms including passive diffusion, active transport, and metabolism within the placenta, with limited in vitro-in vivo correlation methods."
                    },
                    {
                        question: "Albumin concentrations during pregnancy typically:",
                        options: [
                            "Increase by 20-30%",
                            "Remain unchanged",
                            "Decrease by 20-30%",
                            "Show high inter-individual variability"
                        ],
                        correct: 2,
                        explanation: "Albumin concentrations decrease by approximately 20-30% during pregnancy due to hemodilution and increased albumin clearance, affecting protein binding of drugs and their free fractions."
                    },
                    {
                        question: "The ex vivo placental perfusion model (EVPPM) is primarily used to study:",
                        options: [
                            "Maternal protein binding changes",
                            "Fetal organ development",
                            "Placental drug transfer mechanisms",
                            "Amniotic fluid drug concentrations"
                        ],
                        correct: 2,
                        explanation: "EVPPM uses isolated human placenta to study bidirectional drug transfer, metabolism within placental tissue, and the effects of transporters on maternal-fetal drug exchange under controlled conditions."
                    }
                ]
            },
            'gut_microbiome': {
                title: 'Gut Microbiome & GI Modeling',
                description: 'Microbiome effects on drug metabolism and advanced GI tract modeling',
                questions: [
                    {
                        question: "Which bacterial enzyme is primarily responsible for the reduction of sulfasalazine in the colon?",
                        options: [
                            "β-glucuronidase",
                            "Azoreductase",
                            "Nitroreductase", 
                            "Esterase"
                        ],
                        correct: 1,
                        explanation: "Azoreductase enzymes produced by colonic bacteria cleave the azo bond in sulfasalazine, releasing 5-aminosalicylic acid (the active metabolite) and sulfapyridine. This is essential for the drug's therapeutic effect in inflammatory bowel disease."
                    },
                    {
                        question: "In advanced GI-PBPK models, the Advanced Compartmental Absorption and Transit (ACAT) model divides the small intestine into how many compartments?",
                        options: [
                            "3 compartments",
                            "7 compartments",
                            "9 compartments",
                            "12 compartments"
                        ],
                        correct: 2,
                        explanation: "The ACAT model typically uses 9 compartments: stomach, 7 small intestinal segments (duodenum, jejunum 1-4, ileum 1-2), and colon, each with region-specific parameters for pH, transit times, surface area, and enzyme/transporter expression."
                    },
                    {
                        question: "β-glucuronidase activity by gut bacteria primarily affects:",
                        options: [
                            "Phase I metabolite formation",
                            "Enterohepatic recirculation of glucuronide conjugates",
                            "Active transport in enterocytes",
                            "Gastric emptying rates"
                        ],
                        correct: 1,
                        explanation: "Bacterial β-glucuronidase cleaves glucuronide conjugates in bile back to the parent drug, enabling reabsorption and enterohepatic recirculation. This significantly extends drug half-life and can cause toxicity (e.g., irinotecan-induced diarrhea)."
                    },
                    {
                        question: "Which factor is most critical when modeling interindividual variability in gut microbiome drug metabolism?",
                        options: [
                            "Age differences",
                            "Bacterial enzyme expression variability",
                            "Transit time variations",
                            "pH differences"
                        ],
                        correct: 1,
                        explanation: "Bacterial enzyme expression shows enormous interindividual variability (up to 1000-fold) due to differences in microbiome composition, antibiotic history, diet, and genetics, making it the dominant factor in microbiome-mediated drug metabolism variability."
                    },
                    {
                        question: "In PBPK models incorporating microbiome effects, the 'metabolic capacity' of colonic bacteria is typically expressed as:",
                        options: [
                            "Km and Vmax parameters",
                            "First-order rate constants per gram content",
                            "Michaelis-Menten kinetics per bacterial count",
                            "Zero-order elimination rates"
                        ],
                        correct: 1,
                        explanation: "Bacterial metabolic capacity is commonly modeled as first-order rate constants normalized to gram of colonic content, as bacterial counts and enzyme activities are difficult to measure precisely and show high variability."
                    },
                    {
                        question: "The concept of 'microbial metabolic stability' in drug development refers to:",
                        options: [
                            "Bacterial growth rate in culture",
                            "Drug degradation by gut bacteria in vitro",
                            "Antibiotic effects on microbiome",
                            "Probiotic supplementation effects"
                        ],
                        correct: 1,
                        explanation: "Microbial metabolic stability assays use fecal slurries or isolated bacterial strains to measure drug degradation/metabolism by gut bacteria, helping predict colonic metabolism and potential for microbiome-mediated drug interactions."
                    }
                ]
            },
            'ddi_interactions': {
                title: 'Drug-Drug Interactions',
                description: 'Transporter and enzyme-mediated interactions in PBPK context',
                questions: [
                    {
                        question: "For prediction of hepatic OATP1B1-mediated DDIs, the R-value equation incorporates:",
                        options: [
                            "Only hepatic inlet concentration",
                            "Both hepatic inlet and systemic unbound concentrations",
                            "Protein binding in liver tissue",
                            "Biliary clearance parameters"
                        ],
                        correct: 1,
                        explanation: "Hepatic OATP DDI R-values use R = 1 + ([I,u,inlet]/Ki) + ([I,u,sys]/Ki), accounting for both hepatic inlet concentration (relevant for intestinal absorption) and systemic unbound concentration (for IV drugs)."
                    },
                    {
                        question: "Time-dependent inhibition (TDI) of CYP enzymes is characterized by:",
                        options: [
                            "Competitive inhibition kinetics",
                            "Formation of irreversible enzyme-inhibitor complex",
                            "Induction of enzyme expression",
                            "Allosteric modulation"
                        ],
                        correct: 1,
                        explanation: "TDI involves irreversible or quasi-irreversible binding to the enzyme, often through reactive metabolite formation, requiring enzyme resynthesis for activity recovery. This creates time- and concentration-dependent inhibition."
                    },
                    {
                        question: "The 'static model' for DDI prediction assumes:",
                        options: [
                            "Dynamic changes in enzyme expression",
                            "Steady-state inhibitor concentrations",
                            "Non-linear pharmacokinetics",
                            "Time-dependent protein binding"
                        ],
                        correct: 1,
                        explanation: "Static DDI models use steady-state inhibitor concentrations and don't account for temporal changes during treatment initiation/discontinuation, providing initial DDI risk assessment but may under/overestimate complex interactions."
                    },
                    {
                        question: "In renal DDI prediction, the interaction index (R) ≥ 1.1 at the proximal tubule level indicates:",
                        options: [
                            "No clinically relevant interaction",
                            "Potential for ≥25% increase in victim drug exposure",
                            "Induction of renal transporters",
                            "Decreased renal blood flow"
                        ],
                        correct: 1,
                        explanation: "Renal R ≥ 1.1 suggests ≥10% inhibition of renal clearance, which typically translates to ≥25% increase in systemic exposure for drugs with significant renal elimination, warranting clinical DDI studies."
                    },
                    {
                        question: "Perpetrator drugs that are both CYP3A4 and P-gp inhibitors often cause:",
                        options: [
                            "Additive effects on oral bioavailability",
                            "Synergistic increases in victim drug exposure",
                            "Compensatory effects reducing overall interaction",
                            "No change in drug disposition"
                        ],
                        correct: 1,
                        explanation: "Dual CYP3A4/P-gp inhibitors cause synergistic effects because they simultaneously increase intestinal absorption (P-gp inhibition) and decrease first-pass metabolism (CYP3A4 inhibition), leading to disproportionate bioavailability increases."
                    }
                ]
            },
            'special_populations': {
                title: 'Special Populations',
                description: 'PBPK modeling in pediatrics, geriatrics, and disease states',
                questions: [
                    {
                        question: "Which population is typically most challenging to predict using adult PBPK models without physiological adjustments?",
                        options: [
                            "Elderly patients (>75 years)",
                            "Pediatric patients (<12 years)",
                            "Pregnant women",
                            "Obese patients (BMI >35)"
                        ],
                        correct: 1,
                        explanation: "Pediatric populations require extensive physiological adjustments due to developmental changes in organ sizes, blood flows, enzyme expression (especially CYPs), and protein binding that occur from birth through adolescence."
                    },
                    {
                        question: "In hepatic impairment PBPK models, the Child-Pugh score primarily reflects changes in:",
                        options: [
                            "Hepatic blood flow only",
                            "CYP enzyme expression only",
                            "Multiple factors: albumin, bilirubin, PT, ascites, encephalopathy",
                            "Biliary function only"
                        ],
                        correct: 2,
                        explanation: "Child-Pugh classification incorporates albumin, bilirubin, prothrombin time, ascites, and encephalopathy to assess overall hepatic function, requiring corresponding adjustments to multiple PBPK parameters."
                    },
                    {
                        question: "Age-related changes in CYP3A4 expression reach adult levels by approximately:",
                        options: [
                            "6 months",
                            "2 years", 
                            "5 years",
                            "10 years"
                        ],
                        correct: 1,
                        explanation: "CYP3A4 expression is very low at birth, increases rapidly during the first year, and reaches adult levels by approximately 2 years of age, requiring age-specific scaling factors in pediatric PBPK models."
                    },
                    {
                        question: "In renal impairment PBPK models, creatinine clearance is used to scale:",
                        options: [
                            "All renal elimination pathways equally",
                            "Glomerular filtration rate only",
                            "Active secretion and reabsorption pathways",
                            "Both filtration and secretion with different scaling factors"
                        ],
                        correct: 3,
                        explanation: "Creatinine clearance primarily reflects GFR and scales filtration well, but active secretion/reabsorption may be affected differently in renal impairment, requiring separate scaling approaches for different elimination mechanisms."
                    },
                    {
                        question: "Obesity-related changes most significantly affect PBPK predictions for:",
                        options: [
                            "Hydrophilic drugs with small Vd",
                            "Lipophilic drugs with large Vd",
                            "Drugs eliminated by glomerular filtration",
                            "Drugs with high hepatic extraction"
                        ],
                        correct: 1,
                        explanation: "Lipophilic drugs show increased distribution to adipose tissue in obesity, significantly increasing apparent volume of distribution and affecting elimination kinetics, requiring adipose tissue expansion factors in PBPK models."
                    }
                ]
            },
            'regulatory_applications': {
                title: 'Regulatory Applications',
                description: 'PBPK in drug development, regulatory submissions, and model qualification',
                questions: [
                    {
                        question: "For regulatory acceptance, PBPK models typically require prediction accuracy within:",
                        options: [
                            "1.5-fold for AUC and Cmax",
                            "2-fold for AUC and Cmax",
                            "3-fold for AUC and Cmax", 
                            "5-fold for AUC and Cmax"
                        ],
                        correct: 1,
                        explanation: "FDA and EMA guidance generally expect PBPK model predictions within 2-fold of observed values for key parameters (AUC, Cmax) to be considered acceptable for regulatory decision-making."
                    },
                    {
                        question: "The FDA's 'Model-Informed Drug Development' (MIDD) program encourages PBPK use for:",
                        options: [
                            "Replacing all clinical trials",
                            "Supporting dose selection and special population studies",
                            "Marketing applications only",
                            "Post-market surveillance exclusively"
                        ],
                        correct: 1,
                        explanation: "MIDD promotes PBPK models to support dose selection, predict exposures in special populations, assess DDI risks, and optimize clinical trial designs, complementing rather than replacing clinical studies."
                    },
                    {
                        question: "In regulatory submissions, PBPK model 'verification' refers to:",
                        options: [
                            "Comparison with clinical pharmacokinetic data",
                            "Code review and mathematical accuracy check",
                            "Literature validation of physiological parameters",
                            "Cross-platform model comparison"
                        ],
                        correct: 1,
                        explanation: "Model verification ensures the mathematical implementation correctly represents the conceptual model through code review, mass balance checks, and confirmation that equations are properly coded."
                    },
                    {
                        question: "For DDI liability assessment, regulators typically require PBPK validation with:",
                        options: [
                            "At least 3 victim drugs as substrates",
                            "At least 5 victim drugs across different elimination pathways", 
                            "Only the drug being developed",
                            "Positive and negative control compounds"
                        ],
                        correct: 1,
                        explanation: "Robust DDI PBPK models require validation with multiple victim drugs (typically ≥5) representing different elimination pathways to demonstrate model reliability across various scenarios."
                    },
                    {
                        question: "The concept of PBPK model 'qualification' in regulatory context means:",
                        options: [
                            "Initial model development",
                            "Demonstration of fit-for-purpose reliability for specific regulatory questions",
                            "Software validation",
                            "Literature review completion"
                        ],
                        correct: 1,
                        explanation: "Model qualification demonstrates that the PBPK model is reliable and accurate for answering specific regulatory questions (e.g., pediatric dosing, DDI predictions) within defined contexts and limitations."
                    }
                ]
            }
        };

        // Global variables
        let selectedTopics = new Set();
        let currentQuestions = [];
        let currentQuestion = 0;
        let selectedAnswers = [];
        let quizCompleted = false;
        let showingResults = false;
        let quizStartTime = null;
        let questionStartTime = null;
        let questionTimes = [];

        // Initialize the application
        function initApp() {
            populateTopics();
            updateAvailableQuestions();
        }

        function populateTopics() {
            const topicsGrid = document.getElementById('topicsGrid');
            topicsGrid.innerHTML = '';

            Object.keys(questionDatabase).forEach(topicKey => {
                const topic = questionDatabase[topicKey];
                const topicCard = document.createElement('div');
                topicCard.className = 'topic-card';
                topicCard.onclick = () => toggleTopic(topicKey);
                
                topicCard.innerHTML = `
                    <div class="topic-count">${topic.questions.length}</div>
                    <div class="topic-title">${topic.title}</div>
                    <div class="topic-description">${topic.description}</div>
                `;
                
                topicsGrid.appendChild(topicCard);
            });

            // Select all topics by default
            selectAllTopics();
        }

        function toggleTopic(topicKey) {
            const topicCard = event.currentTarget;
            
            if (selectedTopics.has(topicKey)) {
                selectedTopics.delete(topicKey);
                topicCard.classList.remove('selected');
            } else {
                selectedTopics.add(topicKey);
                topicCard.classList.add('selected');
            }
            
            updateAvailableQuestions();
        }

        function selectAllTopics() {
            selectedTopics.clear();
            Object.keys(questionDatabase).forEach(topicKey => {
                selectedTopics.add(topicKey);
            });
            
            document.querySelectorAll('.topic-card').forEach(card => {
                card.classList.add('selected');
            });
            
            updateAvailableQuestions();
        }

        function clearAllTopics() {
            selectedTopics.clear();
            
            document.querySelectorAll('.topic-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            updateAvailableQuestions();
        }

        function updateAvailableQuestions() {
            let totalQuestions = 0;
            selectedTopics.forEach(topicKey => {
                totalQuestions += questionDatabase[topicKey].questions.length;
            });
            
            document.getElementById('availableQuestions').textContent = 
                `Available: ${totalQuestions} questions`;
            
            const questionCountInput = document.getElementById('questionCount');
            const currentCount = parseInt(questionCountInput.value);
            
            if (currentCount > totalQuestions) {
                questionCountInput.value = totalQuestions;
            }
            
            questionCountInput.max = totalQuestions;
        }

        function adjustQuestionCount(delta) {
            const input = document.getElementById('questionCount');
            const currentValue = parseInt(input.value);
            const newValue = Math.max(5, Math.min(parseInt(input.max), currentValue + delta));
            input.value = newValue;
        }

        function startQuiz() {
            if (selectedTopics.size === 0) {
                alert('Please select at least one topic.');
                return;
            }

            const questionCount = parseInt(document.getElementById('questionCount').value);
            
            // Gather all questions from selected topics
            let allQuestions = [];
            selectedTopics.forEach(topicKey => {
                const topic = questionDatabase[topicKey];
                topic.questions.forEach(question => {
                    allQuestions.push({
                        ...question,
                        topic: topicKey,
                        topicTitle: topic.title
                    });
                });
            });

            // Shuffle and select questions
            currentQuestions = shuffleArray(allQuestions).slice(0, questionCount);
            selectedAnswers = new Array(currentQuestions.length).fill(null);
            questionTimes = new Array(currentQuestions.length).fill(0);
            
            currentQuestion = 0;
            quizCompleted = false;
            showingResults = false;
            quizStartTime = Date.now();
            
            // Hide setup, show quiz
            document.getElementById('setupContainer').classList.add('hidden');
            document.getElementById('progressContainer').classList.remove('hidden');
            document.getElementById('questionContainer').classList.remove('hidden');
            
            displayQuestion();
            updateProgress();
            questionStartTime = Date.now();
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function displayQuestion() {
            const question = currentQuestions[currentQuestion];
            
            document.getElementById('questionNumber').textContent = `Question ${currentQuestion + 1}`;
            document.getElementById('topicBadge').textContent = question.topicTitle;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.onclick = () => selectOption(index);
                
                const letter = String.fromCharCode(65 + index);
                optionDiv.innerHTML = `
                    <div class="option-letter">${letter}</div>
                    <div>${option}</div>
                `;
                
                if (selectedAnswers[currentQuestion] === index) {
                    optionDiv.classList.add('selected');
                }
                
                if (quizCompleted) {
                    if (index === question.correct) {
                        optionDiv.classList.add('correct');
                    } else if (selectedAnswers[currentQuestion] === index) {
                        optionDiv.classList.add('incorrect');
                    }
                    optionDiv.onclick = null;
                }
                
                optionsContainer.appendChild(optionDiv);
            });
            
            updateNavigationButtons();
            
            if (quizCompleted) {
                showExplanation();
            } else {
                hideExplanation();
            }
        }

        function selectOption(index) {
            if (quizCompleted) return;
            
            // Record time spent on this question
            if (questionStartTime && selectedAnswers[currentQuestion] === null) {
                questionTimes[currentQuestion] = Date.now() - questionStartTime;
            }
            
            selectedAnswers[currentQuestion] = index;
            displayQuestion();
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / currentQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                `Question ${currentQuestion + 1} of ${currentQuestions.length}`;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.disabled = currentQuestion === 0;
            
            if (currentQuestion === currentQuestions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
                submitBtn.disabled = selectedAnswers[currentQuestion] === null && !quizCompleted;
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
                nextBtn.disabled = selectedAnswers[currentQuestion] === null && !quizCompleted;
            }
        }

        function nextQuestion() {
            if (questionStartTime && selectedAnswers[currentQuestion] !== null) {
                questionTimes[currentQuestion] = Date.now() - questionStartTime;
            }
            
            if (currentQuestion < currentQuestions.length - 1) {
                currentQuestion++;
                displayQuestion();
                updateProgress();
                questionStartTime = Date.now();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                displayQuestion();
                updateProgress();
                questionStartTime = Date.now();
            }
        }

        function submitQuiz() {
            if (questionStartTime && selectedAnswers[currentQuestion] !== null) {
                questionTimes[currentQuestion] = Date.now() - questionStartTime;
            }
            
            quizCompleted = true;
            showResults();
        }

        function showResults() {
            document.getElementById('progressContainer').classList.add('hidden');
            document.getElementById('questionContainer').classList.add('hidden');
            
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.classList.remove('hidden');
            
            const correctAnswers = selectedAnswers.reduce((count, answer, index) => {
                return count + (answer === currentQuestions[index].correct ? 1 : 0);
            }, 0);
            
            const percentage = Math.round((correctAnswers / currentQuestions.length) * 100);
            
            // Calculate average time
            const validTimes = questionTimes.filter(time => time > 0);
            const avgTime = validTimes.length > 0 ? 
                Math.round(validTimes.reduce((a, b) => a + b, 0) / validTimes.length / 1000) : 0;
            
            document.getElementById('scoreDisplay').textContent = `${correctAnswers}/${currentQuestions.length}`;
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('totalCount').textContent = currentQuestions.length;
            document.getElementById('percentage').textContent = `${percentage}%`;
            document.getElementById('averageTime').textContent = `${avgTime}s`;
            
            // Calculate performance by topic
            const topicPerformance = {};
            currentQuestions.forEach((question, index) => {
                const topic = question.topicTitle;
                if (!topicPerformance[topic]) {
                    topicPerformance[topic] = { correct: 0, total: 0 };
                }
                topicPerformance[topic].total++;
                if (selectedAnswers[index] === question.correct) {
                    topicPerformance[topic].correct++;
                }
            });
            
            const topicScores = document.getElementById('topicScores');
            topicScores.innerHTML = '';
            
            Object.keys(topicPerformance).forEach(topic => {
                const perf = topicPerformance[topic];
                const topicPercent = Math.round((perf.correct / perf.total) * 100);
                
                const topicScore = document.createElement('div');
                topicScore.className = 'topic-score';
                topicScore.innerHTML = `
                    <span>${topic}</span>
                    <span>${perf.correct}/${perf.total} (${topicPercent}%)</span>
                `;
                topicScores.appendChild(topicScore);
            });
            
            let message = '';
            if (percentage >= 90) {
                message = 'Outstanding! You have exceptional knowledge of PBPK modeling concepts.';
            } else if (percentage >= 80) {
                message = 'Excellent work! You have a strong understanding of PBPK modeling.';
            } else if (percentage >= 70) {
                message = 'Good performance! Consider reviewing some areas for improvement.';
            } else if (percentage >= 60) {
                message = 'Fair performance. Additional study is recommended.';
            } else {
                message = 'Consider reviewing fundamental concepts and retaking the quiz.';
            }
            
            document.getElementById('scoreMessage').textContent = message;
            showingResults = true;
        }

        function restartQuiz() {
            // Reset everything and go back to setup
            selectedTopics.clear();
            currentQuestions = [];
            selectedAnswers = [];
            questionTimes = [];
            currentQuestion = 0;
            quizCompleted = false;
            showingResults = false;
            
            document.getElementById('setupContainer').classList.remove('hidden');
            document.getElementById('progressContainer').classList.add('hidden');
            document.getElementById('questionContainer').classList.add('hidden');
            document.getElementById('resultsContainer').classList.add('hidden');
            
            initApp();
        }

        function reviewAnswers() {
            showingResults = false;
            currentQuestion = 0;
            
            document.getElementById('progressContainer').classList.remove('hidden');
            document.getElementById('questionContainer').classList.remove('hidden');
            document.getElementById('resultsContainer').classList.add('hidden');
            
            displayQuestion();
            updateProgress();
        }

        function showExplanation() {
            const explanation = document.getElementById('explanation');
            const explanationText = document.getElementById('explanationText');
            
            explanation.classList.remove('hidden');
            explanationText.textContent = currentQuestions[currentQuestion].explanation;
        }

        function hideExplanation() {
            document.getElementById('explanation').classList.add('hidden');
        }

        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
